# 定制审批规则

> Antflow提供了丰富的审批人规则,比如指定人员,指定角色,直属领导审批,hrbp审批等.有些时候用户想要定制自己的审批规则,完整定义一个审批规则需要实现多个策略,较为复杂,后面再补充文档详细介绍。用户可以修改一个现有的审批规则来满足自己的业务需求。比如有些公司没有Hrbp这个角色，那么这个审批规则可能就用不上。用户可以对它进行改造，以适配自己的业务。

## 1.修改前端代码，将hrbp审批改为自己实际审批规则的名字。

## 2.找到HrbpPersonnelProvider

里面有个GetAssigneeList方法，其中BaseIdTranStruVo baseIdTranStruVo = _userService.QueryEmployeeHrpbByEmployeeId(startUserId);是用来找审批人的，

用户只需要改QueryEmployeeHrpbByEmployeeId方法，查询自己的表即可.

# 3.改写Userservice里的ResultAndPage `<BaseIdTranStruVo>` SelectUserPageList(Page `<BaseIdTranStruVo>` page, TaskMgmtVO taskMgmtVo);方法

之所以要改写这个方法，是因为页面上指定人员（或者其它使用人员的地方都用的是这个方法）

## 4.改写List `<BaseIdTranStruVo>` QueryUserByIds(IEnumerable `<String>` userIds);

 和   BaseIdTranStruVo QueryUserById(string userId);二者分别是，根据用户id集合找到用户信息，根据单个用户Id找到单个用户信息


> 没有亲自尝试过的用户可能会有疑问，改写会不会很难？实际上担心是多余的，改写非常容易，不管你的用户表是什么样的。但是至少会包含用的Id和名字信息。`BaseIdTranStruVo`只有两个字段
>
> id和name。



通过以上改造，用户就可将一个现有不用的审批人规则改造来适配自己的业务

## 授人以鱼不如授人以渔，以上HrbpPersonnelProvider是怎么找到的？

上面其实跳过了很多步，直接给用户说了直接操作叔。喜欢深究的用户可能会问。以上HrbpPersonnelProvider是怎么找到的呢？

如果用户尝试在程序中搜索[hrbp]关键字，这其实是一种很好的做法，根据页面的选项搜索后端代码。但是实际上可能搜索出太多的内容，用户无法判断哪一个是自己需要的。（有时候搜索结果范围会大大缩小，比如【直属领导】。这里要记住一点，页面上直属领导，hrbp审批等等审批规则都对应着节点的一个属性，通过这个属性后端就知道当前节点的审批人规则是什么。其实后端有一个叫作NodePropertyEnum的枚举，用户进到这个枚举以后就很容易找到自己上自己要找的审批规则了。点击hrbp审批规则对应的枚举项，会出现多个引用，其中一个叫作PersonnelEnum，再点击它对应的hrbp审批人规则枚举项，就能导航到HrbpPersonnelProvider了。每一个审批人节点都需要有审批人，审批人规则就是这样找到的。
